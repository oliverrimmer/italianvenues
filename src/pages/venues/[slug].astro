---
import BaseLayout from '../../layouts/BaseLayout.astro';

// Define which venue slugs exist
export async function getStaticPaths() {
  return [
    { params: { slug: 'la-posta-vecchia' } },
    { params: { slug: 'mezzatorre-hotel-thermal-spa' } },
    { params: { slug: 'hotel-il-pellicano' } },
  ];
}

const { slug } = Astro.params;

// Dynamically import the venue data based on the slug
const venueData = await import(`../../data/venues/${slug}.json`);
const { name, city, region, maxGuests, exclusiveUse, startingPriceEur, heroImage, intro, usps, gallery, spaces, locationInfo, faqs, contact } = venueData.default;

// Map slugs to Google Maps links (could also be in JSON)
const mapsLinks: Record<string, string> = {
  'la-posta-vecchia': 'https://maps.app.goo.gl/5nnaW6TZWjJtnQnM7',
  'mezzatorre-hotel-thermal-spa': 'https://maps.app.goo.gl/QG8YxN8XK4eNf7uJ9',
  'hotel-il-pellicano': 'https://maps.app.goo.gl/YcA8VbhVjZwZxwYB6',
};
---

<BaseLayout 
  title={`${name} — ${city}, ${region} | ItalianVenues`}
  description={intro}
>
  <!-- HERO SECTION -->
  <section class="relative h-screen bg-black">
    <img
      src={heroImage}
      alt={name}
      class="absolute inset-0 w-full h-full object-cover opacity-70"
    />
    <div class="absolute inset-0 bg-gradient-to-b from-black/60 via-black/40 to-black/70"></div>
    
    <div class="relative z-10 h-full flex flex-col items-center justify-center px-6 text-center">
      <p class="text-[#a78656] text-sm md:text-base font-medium tracking-wider uppercase mb-4">{city}, {region}</p>
      <h1 class="heading-h1 text-white mb-6">
        {name}
      </h1>
      <p class="text-white/90 text-lg md:text-xl max-w-2xl mb-8">
        {intro.substring(0, 120)}...
      </p>
      <a href="#contact" class="inline-flex items-center px-8 py-4 border-2 border-[#a78656] text-[#a78656] font-medium hover:bg-[#a78656] hover:text-white transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-[#a78656] rounded">
        Enquire Now
      </a>
    </div>
  </section>

  <!-- STICKY NAVIGATION BAR -->
  <nav id="sticky-nav" class="sticky top-0 z-40 bg-white border-b border-zinc-200 shadow-sm transition-all duration-200">
    <div class="container mx-auto px-6 max-w-7xl">
      <div class="flex items-center gap-6 overflow-x-auto scrollbar-hide">
        <a href="#overview" class="nav-link py-4 px-2 text-sm font-medium text-zinc-700 hover:text-[#a78656] whitespace-nowrap transition-colors">Overview</a>
        <a href="#gallery" class="nav-link py-4 px-2 text-sm font-medium text-zinc-700 hover:text-[#a78656] whitespace-nowrap transition-colors">Gallery</a>
        <a href="#details" class="nav-link py-4 px-2 text-sm font-medium text-zinc-700 hover:text-[#a78656] whitespace-nowrap transition-colors">Details</a>
        <a href="#location" class="nav-link py-4 px-2 text-sm font-medium text-zinc-700 hover:text-[#a78656] whitespace-nowrap transition-colors">Location</a>
        <a href="#faqs" class="nav-link py-4 px-2 text-sm font-medium text-zinc-700 hover:text-[#a78656] whitespace-nowrap transition-colors">FAQs</a>
        <a href="#contact" class="nav-link py-4 px-2 text-sm font-medium text-zinc-700 hover:text-[#a78656] whitespace-nowrap transition-colors">Contact</a>
      </div>
    </div>
  </nav>

  <!-- OVERVIEW SECTION -->
  <section id="overview" class="bg-white py-20 md:py-28">
    <div class="container mx-auto px-6 max-w-6xl">
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-12 lg:gap-16">
        <!-- Intro Text -->
        <div>
          <h2 class="heading-h2 font-semibold mb-6">About {name}</h2>
          <p class="text-lg leading-relaxed text-zinc-700 mb-6">{intro}</p>
          <div class="flex flex-wrap gap-4">
            <div class="px-4 py-2 bg-zinc-100 rounded-lg">
              <p class="text-sm text-zinc-600">Max Guests</p>
              <p class="text-xl font-semibold text-black">{maxGuests}</p>
            </div>
            {exclusiveUse && (
              <div class="px-4 py-2 bg-zinc-100 rounded-lg">
                <p class="text-sm text-zinc-600">Exclusive Use</p>
                <p class="text-xl font-semibold text-black">Yes</p>
              </div>
            )}
            {startingPriceEur > 0 && (
              <div class="px-4 py-2 bg-zinc-100 rounded-lg">
                <p class="text-sm text-zinc-600">Starting From</p>
                <p class="text-xl font-semibold text-black">€{startingPriceEur.toLocaleString()}</p>
              </div>
            )}
          </div>
        </div>

        <!-- USP Cards -->
        <div>
          <h3 class="heading-h3 font-semibold mb-6">Key Features</h3>
          <ul class="space-y-4">
            {usps.map((usp) => (
              <li class="flex items-start gap-3">
                <svg class="w-6 h-6 text-[#a78656] flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                </svg>
                <span class="text-lg text-zinc-700">{usp}</span>
              </li>
            ))}
          </ul>
        </div>
      </div>
    </div>
  </section>

  <!-- GALLERY SECTION -->
  <section id="gallery" class="bg-zinc-50 py-20 md:py-28">
    <div class="container mx-auto px-6 max-w-7xl">
      <h2 class="heading-h2 font-semibold mb-12 text-center">Gallery</h2>
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
        {gallery.map((image, index) => (
          <div class="relative aspect-[4/3] rounded-xl overflow-hidden">
            <img 
              src={image} 
              alt={`${name} - Image ${index + 1}`}
              class="w-full h-full object-cover"
            />
          </div>
        ))}
      </div>
    </div>
  </section>

  <!-- SPACES & CAPACITY SECTION -->
  <section id="details" class="bg-white py-20 md:py-28">
    <div class="container mx-auto px-6 max-w-5xl">
      <h2 class="heading-h2 font-semibold mb-12 text-center">Spaces & Capacity</h2>
      <div class="overflow-x-auto">
        <table class="w-full border border-zinc-200 rounded-lg">
          <thead class="bg-zinc-100">
            <tr>
              <th class="px-6 py-4 text-left text-sm font-semibold text-zinc-900">Space</th>
              <th class="px-6 py-4 text-left text-sm font-semibold text-zinc-900">Capacity</th>
            </tr>
          </thead>
          <tbody>
            {spaces.map((space, index) => (
              <tr class={index % 2 === 0 ? 'bg-white' : 'bg-zinc-50'}>
                <td class="px-6 py-4 text-zinc-800 font-medium">{space.name}</td>
                <td class="px-6 py-4 text-zinc-600">{space.capacity}</td>
              </tr>
            ))}
          </tbody>
        </table>
      </div>
    </div>
  </section>

  <!-- LOCATION SECTION -->
  <section id="location" class="bg-white py-20 md:py-28">
    <div class="container mx-auto px-6 max-w-7xl">
      <h2 class="heading-h2 font-semibold mb-12 text-center">Location</h2>
      
      <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        <!-- Map - Takes 2 columns -->
        <div class="lg:col-span-2">
          <div class="rounded-2xl overflow-hidden shadow-xl border border-zinc-200" style="height: 500px;">
            <iframe
              src={locationInfo.mapEmbed}
              width="100%"
              height="100%"
              style="border:0;"
              allowfullscreen=""
              loading="lazy"
              referrerpolicy="no-referrer-when-downgrade"
              title={`Map of ${name}`}
            ></iframe>
          </div>
          <a 
            href={mapsLinks[slug]} 
            target="_blank"
            rel="noopener noreferrer"
            class="inline-flex items-center gap-2 mt-4 text-[#a78656] hover:text-[#8f6d47] font-medium transition-colors"
          >
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
            </svg>
            View larger map & get directions
          </a>
        </div>

        <!-- Info Panel - Takes 1 column -->
        <div class="space-y-6">
          <!-- Address Card -->
          <div class="bg-zinc-50 rounded-xl p-6 border border-zinc-200">
            <div class="flex items-start gap-3 mb-4">
              <svg class="w-6 h-6 text-[#a78656] flex-shrink-0 mt-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
              </svg>
              <div>
                <h3 class="font-semibold text-lg text-zinc-900 mb-2">Address</h3>
                <p class="text-zinc-700 leading-relaxed">{locationInfo.address}</p>
              </div>
            </div>
          </div>

          <!-- Travel Times -->
          <div class="bg-zinc-50 rounded-xl p-6 border border-zinc-200">
            <div class="flex items-center gap-3 mb-4">
              <svg class="w-6 h-6 text-[#a78656]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
              </svg>
              <h3 class="font-semibold text-lg text-zinc-900">Travel Times</h3>
            </div>
            <div class="space-y-3">
              {Object.entries(locationInfo.distances).map(([location, distance]) => (
                <div class="flex items-center justify-between py-2 border-b border-zinc-200 last:border-0">
                  <div class="flex items-center gap-2">
                    <svg class="w-4 h-4 text-zinc-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7"></path>
                    </svg>
                    <span class="text-zinc-700 text-sm font-medium">{location}</span>
                  </div>
                  <span class="text-zinc-600 text-sm font-medium">{distance}</span>
                </div>
              ))}
            </div>
          </div>

          <!-- CTA -->
          <a 
            href="#contact" 
            class="block w-full text-center px-6 py-3 bg-[#a78656] text-white font-semibold rounded-lg hover:bg-[#8f6d47] transition-colors duration-200"
          >
            Request Details
          </a>
        </div>
      </div>
    </div>
  </section>

  <!-- FAQs SECTION -->
  <section id="faqs" class="bg-white py-20 md:py-28">
    <div class="container mx-auto px-6 max-w-4xl">
      <h2 class="heading-h2 font-semibold mb-12 text-center">Frequently Asked Questions</h2>
      <div class="space-y-4">
        {faqs.map((faq, index) => (
          <details class="group border border-zinc-200 rounded-lg">
            <summary class="flex justify-between items-center cursor-pointer px-6 py-5 hover:bg-zinc-50 transition-colors">
              <h3 class="text-lg font-medium text-zinc-900 pr-8">{faq.q}</h3>
              <svg class="w-5 h-5 text-zinc-500 transition-transform group-open:rotate-180" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
              </svg>
            </summary>
            <div class="px-6 pb-5 text-zinc-700 leading-relaxed">
              {faq.a}
            </div>
          </details>
        ))}
      </div>
    </div>
  </section>

  <!-- CONTACT SECTION -->
  <section id="contact" class="bg-[hsl(0,0%,3%)] text-white py-20 md:py-28">
    <div class="container mx-auto px-6 max-w-2xl">
      <h2 class="heading-h2 font-semibold mb-6 text-center">{contact.cta}</h2>
      <p class="text-center text-zinc-400 mb-12">Fill out the form below and we'll respond within 24 hours.</p>
      
      <form class="space-y-6">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div>
            <label for="name" class="block text-sm font-medium text-zinc-300 mb-2">Full Name *</label>
            <input
              type="text"
              id="name"
              name="name"
              required
              class="w-full px-4 py-3 bg-white/5 border border-zinc-700 rounded-lg text-white placeholder:text-zinc-500 focus:outline-none focus:ring-2 focus:ring-[#a78656] focus:border-transparent"
              placeholder="John Smith"
            />
          </div>
          <div>
            <label for="email" class="block text-sm font-medium text-zinc-300 mb-2">Email *</label>
            <input
              type="email"
              id="email"
              name="email"
              required
              class="w-full px-4 py-3 bg-white/5 border border-zinc-700 rounded-lg text-white placeholder:text-zinc-500 focus:outline-none focus:ring-2 focus:ring-[#a78656] focus:border-transparent"
              placeholder="john@example.com"
            />
          </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div>
            <label for="guests" class="block text-sm font-medium text-zinc-300 mb-2">Number of Guests</label>
            <input
              type="number"
              id="guests"
              name="guests"
              class="w-full px-4 py-3 bg-white/5 border border-zinc-700 rounded-lg text-white placeholder:text-zinc-500 focus:outline-none focus:ring-2 focus:ring-[#a78656] focus:border-transparent"
              placeholder="100"
            />
          </div>
          <div>
            <label for="date" class="block text-sm font-medium text-zinc-300 mb-2">Preferred Date</label>
            <input
              type="date"
              id="date"
              name="date"
              class="w-full px-4 py-3 bg-white/5 border border-zinc-700 rounded-lg text-white placeholder:text-zinc-500 focus:outline-none focus:ring-2 focus:ring-[#a78656] focus:border-transparent"
            />
          </div>
        </div>

        <div>
          <label for="message" class="block text-sm font-medium text-zinc-300 mb-2">Message *</label>
          <textarea
            id="message"
            name="message"
            rows="6"
            required
            class="w-full px-4 py-3 bg-white/5 border border-zinc-700 rounded-lg text-white placeholder:text-zinc-500 focus:outline-none focus:ring-2 focus:ring-[#a78656] focus:border-transparent resize-none"
            placeholder="Tell us about your event..."
          ></textarea>
        </div>

        <button
          type="submit"
          class="w-full px-8 py-4 bg-[#a78656] text-white font-semibold rounded-lg hover:bg-[#8f6d47] transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-[#a78656] focus:ring-offset-2 focus:ring-offset-[hsl(0,0%,3%)]"
        >
          Send Enquiry
        </button>
      </form>
    </div>
  </section>
</BaseLayout>

<style>
  /* Smooth accordion animation */
  details summary::-webkit-details-marker {
    display: none;
  }
  
  details[open] summary {
    border-bottom: 1px solid rgb(228, 228, 231);
  }

  /* Smooth transitions */
  * {
    transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
  }

  /* Active navigation link with gold underline */
  .nav-link.active {
    color: #a78656;
    border-bottom: 2px solid #a78656;
  }
</style>

<script>
  // Track active section with Intersection Observer
  document.addEventListener('DOMContentLoaded', () => {
    const sections = document.querySelectorAll('section[id]');
    const navLinks = document.querySelectorAll('.nav-link');
    const stickyNav = document.getElementById('sticky-nav');

    // Create observer to watch for scroll position
    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            // Update active nav link
            const id = entry.target.getAttribute('id');
            navLinks.forEach((link) => {
              link.classList.remove('active');
              if (link.getAttribute('href') === `#${id}`) {
                link.classList.add('active');
              }
            });
          }
        });
      },
      {
        threshold: 0.3,
        rootMargin: '-80px 0px -70% 0px', // Trigger when section is in top portion of viewport
      }
    );

    // Observe all sections
    sections.forEach((section) => {
      observer.observe(section);
    });

    // Smooth scroll behavior
    navLinks.forEach((link) => {
      link.addEventListener('click', (e) => {
        e.preventDefault();
        const targetId = link.getAttribute('href');
        const targetSection = document.querySelector(targetId);
        
        if (targetSection) {
          const offsetTop = targetSection.offsetTop - (stickyNav?.offsetHeight || 0);
          window.scrollTo({
            top: offsetTop,
            behavior: 'smooth',
          });
        }
      });
    });
  });
</script>

